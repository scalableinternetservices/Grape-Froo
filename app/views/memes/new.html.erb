<% provide(:title, "New Meme") %>
<div class="row">
  <div class="col-md-12">
    <h2 id="subheader">New Meme</h2>
  </div>
  <div class="text-center col-md-12">
    Select Template:<br>
    <input id="template-search" type="text" placeholder="Search Templates">
    <br>
    <div class="row" id="results"></div>
    <br>
    <br>
    <div class="row">
    <%= bootstrap_form_tag url: new_meme_path, method: "get", :html => {:id => 'meme_gen'} , layout: :inline do %>
	        <div class="col-md-6">
	        <%= text_field(:meme, :top_caption, :id => "top-line", :placeholder => "Top Text")%>
	        </div>
	        <div class="col-md-6">
	        <%= text_field(:meme, :bottom_caption, :id => "bottom-line", :placeholder => "Bottom Text") %>
	        </div>
          <%= submit_tag :submit, name: nil, value: nil%>
	    </div>
	    <br>
        <br>
        <canvas id="meme"></canvas>
     <% end %>
  </div>
</div>
<div class="clearfix"></div>

<% content_for :footerjs do %>
	<!-- for meme_gen.js -->
 	<script type="text/javascript">
    var template_url = '';
    var template_id;
    var update_meme = function() {
      Meme(template_url, 'meme', $('#top-line').val(), $('#bottom-line').val());
    }
		$('#top-line, #bottom-line').keyup(update_meme);

    $("#meme_gen").submit( function(eventObj) {
      $('<input />').attr('type', 'hidden')
          .attr('name', "meme[template_id]")
          .attr('value', template_id)
          .appendTo('#meme_gen');
    });
 	</script>

	<script type="text/javascript">
    $("#template-search").keyup(_.debounce(function() {
      if ($(this).val().trim()) {
        $.ajax({
          url: '/templates',
          context: document.body,
          data: {
            query: $(this).val(),
          },
          dataType: "script",
          success: function() {
                      $('.template-img').click(function(event) {
                        template_url = $(this).attr('src');
                        template_id = $(this).data("template-id");
                        update_meme();
                      });
                    },
        });
      } else {
        $("#results").html("");
      }
    }, 500));
	</script>
<% end %>


